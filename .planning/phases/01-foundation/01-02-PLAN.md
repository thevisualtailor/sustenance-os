---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - package.json
  - vite.config.js
  - index.html
  - public/pwa-192x192.png
  - public/pwa-512x512.png
  - public/apple-touch-icon.png
autonomous: false

must_haves:
  truths:
    - "User can add Sustenance OS to iPhone home screen via Share > Add to Home Screen"
    - "App opens full-screen with no Safari browser chrome when launched from home screen"
    - "Home screen icon displays a recognizable app icon (not a blank/default square)"
    - "Status bar blends with the dark theme (black-translucent)"
  artifacts:
    - path: "vite.config.js"
      provides: "PWA plugin config with manifest and workbox"
      contains: "VitePWA"
    - path: "index.html"
      provides: "iPhone-specific meta tags for standalone mode"
      contains: "apple-mobile-web-app-capable"
    - path: "public/apple-touch-icon.png"
      provides: "180x180 PNG icon for iPhone home screen"
    - path: "public/pwa-192x192.png"
      provides: "192x192 icon for Android/generic PWA"
    - path: "public/pwa-512x512.png"
      provides: "512x512 icon for PWA splash screen"
  key_links:
    - from: "vite.config.js"
      to: "public/pwa-192x192.png"
      via: "manifest icons array"
      pattern: "pwa-192x192.png"
    - from: "index.html"
      to: "public/apple-touch-icon.png"
      via: "link rel=apple-touch-icon"
      pattern: 'rel="apple-touch-icon"'
    - from: "index.html"
      to: "meta apple-mobile-web-app-capable"
      via: "meta tag"
      pattern: "apple-mobile-web-app-capable"
---

<objective>
Configure PWA support so Sustenance OS is installable on iPhone home screen and launches in standalone full-screen mode with no browser chrome.

Purpose: This is a core UX requirement -- Jay uses Sustenance OS from his iPhone home screen like a native app. Without PWA config, it opens in Safari with URL bar and tabs visible, breaking the immersion.
Output: A fully PWA-configured app with manifest, service worker (via vite-plugin-pwa), iPhone-specific meta tags, and app icons.
</objective>

<execution_context>
@/Users/jaycarter/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jaycarter/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md

Reference for PWA patterns:
@vite.config.js
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add vite-plugin-pwa, manifest, icons, and iPhone meta tags</name>
  <files>
    package.json
    vite.config.js
    index.html
    public/pwa-192x192.png
    public/pwa-512x512.png
    public/apple-touch-icon.png
  </files>
  <action>
    **Install vite-plugin-pwa:**
    - `npm install -D vite-plugin-pwa` (adds to devDependencies)
    - Research confirms v1.2.0 is compatible with Vite 7

    **Generate PWA icons:**
    - Create simple, recognizable app icons programmatically. Use a canvas-based approach or create minimal SVG-to-PNG icons.
    - Option A (preferred): Use Node.js with a script to generate solid-color icons with a letter "S" in Geist font style. Create a one-off script `scripts/generate-icons.js` that:
      - Creates a 512x512 canvas (use `canvas` npm package or sharp)
      - Fills with #0a0a0a background
      - Draws a centered "S" character in #4a9eff (accent color)
      - Exports as 512x512, 192x192, and 180x180 PNGs
      - Place in public/ directory
    - Option B (if canvas/sharp is complex): Generate minimal placeholder PNGs using ImageMagick if available (`convert -size 512x512 xc:#0a0a0a -fill '#4a9eff' -pointsize 280 -gravity center -annotate 0 'S' public/pwa-512x512.png`), or create 1x1 colored PNGs as temporary placeholders.
    - The icons must be REAL PNG files, not empty files. A simple solid-color square with a letter is fine for now.
    - Required outputs:
      - `public/pwa-512x512.png` (512x512)
      - `public/pwa-192x192.png` (192x192)
      - `public/apple-touch-icon.png` (180x180)

    **Update vite.config.js:**
    - Import VitePWA from 'vite-plugin-pwa'
    - Add to plugins array with this exact config (from research):
      ```javascript
      VitePWA({
        registerType: 'autoUpdate',
        workbox: {
          globPatterns: ['**/*.{js,css,html,ico,png,svg,woff2}'],
        },
        manifest: {
          name: 'Sustenance OS',
          short_name: 'Sustenance',
          description: 'BED-safe nutrition coaching',
          theme_color: '#0a0a0a',
          background_color: '#0a0a0a',
          display: 'standalone',
          scope: '/',
          start_url: '/',
          icons: [
            { src: '/pwa-192x192.png', sizes: '192x192', type: 'image/png', purpose: 'any' },
            { src: '/pwa-512x512.png', sizes: '512x512', type: 'image/png', purpose: 'maskable' },
          ],
        },
      })
      ```
    - IMPORTANT: `display: 'standalone'` is what makes it full-screen on iPhone

    **Update index.html:**
    - Add these iPhone-specific meta tags in `<head>` (after existing meta tags, before font links):
      ```html
      <meta name="apple-mobile-web-app-capable" content="yes" />
      <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
      <meta name="apple-mobile-web-app-title" content="Sustenance" />
      <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
      ```
    - IMPORTANT per research: iPhone ignores the manifest icons and ONLY uses the apple-touch-icon link tag. Both are needed.
    - The theme-color meta tag should already be present from Plan 01. If not, add it.

    Run `npm run build` to verify the PWA plugin generates the service worker and manifest in dist/.
  </action>
  <verify>
    `npm run build` exits 0.
    `ls dist/` shows manifest.webmanifest (or similar manifest file) and a sw.js (service worker).
    `cat dist/manifest.webmanifest` (or dist/.vite/manifest.json) contains "Sustenance OS" and "standalone".
    `public/pwa-512x512.png` exists and is a valid PNG (file size > 100 bytes).
    `public/apple-touch-icon.png` exists and is a valid PNG (file size > 100 bytes).
    `grep "apple-mobile-web-app-capable" index.html` returns a match.
    `grep "apple-touch-icon" index.html` returns a match.
  </verify>
  <done>
    vite-plugin-pwa generates a manifest with display:standalone and a service worker on build. index.html has all iPhone meta tags. Icon files exist in public/. The app is installable as a PWA.
  </done>
</task>

<task type="auto">
  <name>Task 2: Deploy PWA update to Vercel</name>
  <files>
    (no new files -- deploys existing changes)
  </files>
  <action>
    Commit the PWA changes:
    - `git add package.json package-lock.json vite.config.js index.html public/pwa-192x192.png public/pwa-512x512.png public/apple-touch-icon.png`
    - Commit with message describing PWA addition

    Push to GitHub (triggers Vercel auto-deploy if connected, otherwise manual deploy):
    - `git push`

    If Vercel is connected to GitHub (set up in Plan 01), the push triggers auto-deploy. Otherwise:
    - `npx vercel --prod` to deploy manually

    After deploy completes, verify the production URL:
    - curl the Vercel URL and check for apple-mobile-web-app-capable in the response
    - curl the manifest URL (typically /manifest.webmanifest) and verify it contains "standalone"
  </action>
  <verify>
    Production Vercel URL returns HTML with apple-mobile-web-app-capable meta tag.
    Manifest is accessible at production URL + /manifest.webmanifest (or wherever vite-plugin-pwa places it).
    Service worker is registered (check for sw.js in the network response).
  </verify>
  <done>
    PWA-configured app is live on Vercel production URL. Manifest serves display:standalone. Service worker is registered. iPhone meta tags are in the HTML.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Full Phase 1 deliverable: Sustenance OS scaffold deployed to Vercel as an installable PWA.

    What was built:
    1. Vite + vanilla JS project scaffolded from Compound OS patterns
    2. Dark theme with correct fonts (Geist headings, Roboto Mono body, Instrument Serif title)
    3. Mobile-first layout (600px max-width main area, finger-friendly sizing)
    4. PWA manifest with standalone display mode
    5. iPhone-specific meta tags for home screen installation
    6. Service worker for offline caching
    7. App icons (512x512, 192x192, 180x180 apple-touch-icon)
    8. Deployed to Vercel production URL
  </what-built>
  <how-to-verify>
    **Desktop quick check:**
    1. Open the Vercel production URL in Chrome
    2. Verify: Dark background (#0a0a0a), "Sustenance OS" header, placeholder text visible
    3. Open DevTools > Application > Manifest -- should show "Sustenance OS" with display: standalone
    4. Open DevTools > Application > Service Workers -- should show a registered service worker

    **iPhone home screen test (the real test):**
    1. Open the Vercel production URL in Safari on your iPhone
    2. Tap the Share button (box with arrow)
    3. Tap "Add to Home Screen"
    4. Verify the icon shows (not a blank square)
    5. Tap "Add"
    6. Open the app from the home screen
    7. Verify: NO Safari browser chrome (no URL bar, no tabs, no navigation buttons)
    8. Verify: Status bar blends with the dark background
    9. Verify: App displays the dark-themed scaffold with "Sustenance OS" header
    10. Verify: No horizontal scrolling, text is readable, layout fills the screen properly

    **If issues found:** Describe what you see -- which step fails and what appears instead of what was expected.
  </how-to-verify>
  <resume-signal>Type "approved" if the app works from the iPhone home screen with no browser chrome. Otherwise describe the issues you see.</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` succeeds and produces dist/ with manifest and service worker
2. Production Vercel URL loads with dark theme and correct fonts
3. Manifest contains display: standalone and correct app name
4. Service worker registers successfully
5. iPhone home screen launch shows NO browser chrome
6. Apple-touch-icon displays on home screen (not a blank default)
7. Status bar is black-translucent, blending with dark theme
</verification>

<success_criteria>
- User opens app from iPhone home screen with zero browser chrome visible
- App loads on Vercel production URL from any device
- Mobile layout is finger-friendly with no horizontal scrolling
- PWA manifest and service worker are active
- Visual style matches Compound OS dark theme
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
